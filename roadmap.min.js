/*! roadmap.js v0.0.1 - MIT license 
2015-06-25 - Florent Solt */
!function(){var a=function(){var a=d3.scale.category10();d3.selectAll("div.roadmap").each(function(){var c=[],d=[],e={};lines=(this.textContent||this.innerHTML||"").split("\n");for(var f,g=0;f=lines[g],g<lines.length;g++)f=f.replace(/^\s+|\s+$/g,""),e.name||e.group?e.from||e.to?""===f?""===f&&e.name&&(c.push(e),e={}):d.push({group:f,from:e.from,to:e.to,name:e.group+", "+e.name,color:a(e.group)}):(texts=f.replace(/[^0-9\-\/]+/," ").split(" "),e.from=texts[0],e.to=texts[1]):(texts=f.split(","),e.group=texts[0],e.name=texts.slice(1).join(","),e.color=a(e.group));if(c.length>0){this.innerHTML="";var h=b(this,c);d.sort(function(a,b){return a.group>b.group?1:-1}),d.length>0&&b(this,d,h+50)}})},b=function(a,b){for(var c=d3.time.format("%Y-%m-%d"),d=20,e=d+4,f=20+(f||0),g=b.length*e+f+40,h=a.clientWidth,i=d3.select(a).append("svg").attr("width",h).attr("height",g).attr("style","overflow: visible"),j=[],k=0,l=0;l<b.length;l++){for(var m=0,n=!1;m<j.length&&!n;)n=j[m].name===b[l].group,m++;if(!n){var o=0;for(m=0;m<b.length;)b[m].group==b[l].group&&o++,m++;j.push({name:b[l].group,count:o,previous:k}),k+=o}}i.append("g").selectAll("rect").data(j).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*e+f}).attr("width",function(){return h}).attr("height",function(a){return a.count*e-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var p=i.append("g").selectAll("text").data(j).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*e/2+a.previous*e+f}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),q=p[0].parentNode.getBBox().width+15,r=d3.time.scale().clamp(!0).domain([d3.min(b,function(a){return c.parse(a.from)}),d3.max(b,function(a){var b=c.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,h-q-15]),s=d3.svg.axis().scale(r).orient("bottom").ticks(d3.time.monday).tickSize(-g+f+20,0,0).tickFormat(d3.time.format("%b %d")),t=i.append("g").attr("transform","translate("+q+", "+(g-30)+")").call(s),u=new Date;u>r.domain()[0]&&u<r.domain()[1]&&(t.append("line").attr("x1",r(u)).attr("y1",0).attr("x2",r(u)).attr("y2",-g+f+20).attr("class","now"),t.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),t.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),t.selectAll(".tick line").attr("stroke","#dddddd").attr("shape-rendering","crispEdges");var v=i.append("g").selectAll("rect").data(b).enter();return v.append("rect").attr("rx",3).attr("ry",3).attr("x",function(a){return r(c.parse(a.from))+q}).attr("y",function(a,b){return b*e+f}).attr("width",function(a){var b=c.parse(a.to);return b.setHours(b.getHours()+24),r(b)-r(c.parse(a.from))}).attr("height",d).attr("stroke","none").attr("fill",function(a){return a.color}).attr("fill-opacity",.5),v.append("text").text(function(a){return a.name}).attr("x",function(a){return(r(c.parse(a.to))-r(c.parse(a.from)))/2+r(c.parse(a.from))+q}).attr("y",function(a,b){return b*e+14+f}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",d).attr("fill","#000"),g};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&a(),window.Roadmap={init:a}})}();