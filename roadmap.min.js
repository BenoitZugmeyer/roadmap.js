/*! roadmap.js v0.0.1 - MIT license 
2015-07-02 - Florent Solt */
!function(){function a(a){switch(a.type){case"people":return a.taskGroup;case"task":return a.group;case"group":return a.name}}function b(b){var e=c(a(b));d===e?(d3.selectAll(".item").style("opacity",1),d=!1):(d3.selectAll(".item").style("opacity",.2),d3.selectAll("."+e).style("opacity",1),d=e)}function c(a){return"_"+a.toLowerCase().replace(/[^a-z0-9]+/g,function(){return"-"})}var d=!1,e=function(){var a=d3.scale.category20();d3.selectAll("div.roadmap").each(function(){var b=[],c=[],d={};lines=(this.textContent||this.innerHTML||"").split("\n");for(var e,g=0;e=lines[g],g<lines.length;g++)if(e=e.replace(/^\s+|\s+$/g,""),d.name||d.group)if(d.from||d.to)if(""===e)""===e&&d.name&&(b.push(d),d={});else{var h,i;(h=e.match(/\s+(\d+)%\s*$/))?(i=parseInt(h[1],10),e=e.substring(0,e.length-h[0].length)):i=100,c.push({type:"people",group:e,from:d.from,to:d.to,name:d.group+" â€” "+d.name,taskGroup:d.group,color:a(d.group),involvement:i})}else texts=e.replace(/[^0-9\-\/]+/," ").split(" "),d.from=texts[0],d.to=texts[1];else texts=e.split(","),d.type="task",d.group=texts[0],d.name=texts.slice(1).join(","),d.color=a(d.group);if(b.length>0){this.innerHTML="";var j=f(this,b,{});c.sort(function(a,b){return a.group>b.group?1:-1}),c.length>0&&f(this,c,j)}})},f=function(d,e,f){var g=d3.time.format("%Y-%m-%d"),h=20,i=h+4,j=20,k=e.length*i+j+40,l=d.clientWidth,m=d3.select(d).append("svg").attr("width",l).attr("height",k).attr("style","overflow: visible");e.sort(function(a,b){return a.group===b.group?g.parse(a.from)>g.parse(b.from)?1:-1:a.group>b.group?1:-1});for(var n=[],o=0,p=0;p<e.length;p++){for(var q=0,r=!1;q<n.length&&!r;)r=n[q].name===e[p].group,q++;if(!r){var s=0;for(q=0;q<e.length;)e[q].group==e[p].group&&s++,q++;n.push({type:"group",name:e[p].group,count:s,previous:o}),o+=s}}var t=0;for(p=0;p<e.length;p++)"people"==e[p].type&&100!=e[p].involvement&&(m.append("defs").append("pattern").attr({id:"pattern"+t,width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr({width:Math.ceil(8*e[p].involvement/100),height:"8",transform:"translate(0,0)",fill:e[p].color}),e[p].color="url(#pattern"+t+")",t++);m.append("g").selectAll("rect").data(n).enter().append("rect").attr("rx",3).attr("ry",3).attr("x",0).attr("y",function(a){return a.previous*i+j}).attr("width",function(){return l}).attr("height",function(a){return a.count*i-4}).attr("stroke","none").attr("fill","#999").attr("fill-opacity",.1);var u=m.append("g").selectAll("text").data(n).enter().append("text").text(function(a){return a.name}).attr("x",10).attr("y",function(a){return a.count*i/2+a.previous*i+j}).attr("font-size",11).attr("text-anchor","start").attr("text-height",14).attr("fill","#000"),v=f.sidePadding||u[0].parentNode.getBBox().width+15,w=d3.time.scale().clamp(!0).domain([d3.min(e,function(a){return g.parse(a.from)}),d3.max(e,function(a){var b=g.parse(a.to);return b.setHours(b.getHours()+24)})]).range([0,l-v-15]),x=d3.svg.axis().scale(w).orient("bottom").ticks(d3.time.monday).tickSize(-k+j+20,0,0).tickFormat(d3.time.format("%b %d")),y=m.append("g").attr("transform","translate("+v+", "+(k-30)+")").call(x),z=new Date;z>w.domain()[0]&&z<w.domain()[1]&&(y.append("line").attr("x1",w(z)).attr("y1",0).attr("x2",w(z)).attr("y2",-k+j+20).attr("class","now"),y.selectAll(".now").attr("stroke","red").attr("opacity",.5).attr("stroke-dasharray","2,2").attr("shape-rendering","crispEdges")),y.selectAll("text").style("text-anchor","middle").attr("fill","#000").attr("stroke","none").attr("font-size",10).attr("dy","1em"),y.selectAll(".tick line").attr("stroke","#dddddd").attr("shape-rendering","crispEdges");var A=m.append("g").selectAll("rect").data(e).enter();A.append("rect").attr("class",function(b){return"item "+c(a(b))}).attr("rx",3).attr("ry",3).attr("x",function(a){return w(g.parse(a.from))+v}).attr("y",function(a,b){return b*i+j}).attr("width",function(a){var b=g.parse(a.to);return b.setHours(b.getHours()+24),w(b)-w(g.parse(a.from))}).attr("height",h).attr("stroke","none").attr("fill",function(a){return a.color}).attr("fill-opacity",.5).on("mouseover",function(){d3.select(this).style({cursor:"pointer"})}).on("click",b),A.append("text").attr("class",function(b){return"item "+c(a(b))}).text(function(a){return a.name}).attr("x",function(a){return(w(g.parse(a.to))-w(g.parse(a.from)))/2+w(g.parse(a.from))+v}).attr("y",function(a,b){return b*i+14+j}).attr("font-size",11).attr("text-anchor","middle").attr("text-height",h).attr("fill","#000").style("pointer-events","none");var B=m.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0).style("stroke","black").style("stroke-width","1px").style("stroke-dasharray","2,2").style("shape-rendering","crispEdges").style("pointer-events","none").style("display","none"),C=m.append("rect").attr("rx",3).attr("ry",3).attr("width",50).attr("height",h).attr("stroke","none").attr("fill","black").attr("fill-opacity",.8).style("display","none"),D=m.append("text").attr("font-size",11).attr("font-weight","bold").attr("text-anchor","middle").attr("text-height",h).attr("fill","white").style("display","none"),E=40;return m.on("mousemove",function(){var a=d3.mouse(this)[0],b=d3.mouse(this)[1];a>v?(B.attr("x1",a).attr("y1",j-10).attr("x2",a).attr("y2",k-30).style("display","block"),C.attr("x",a-25).attr("y",b-(h+8)/2+E).style("display","block"),D.attr("transform","translate("+a+","+(b+E)+")").text(d3.time.format("%b %d")(w.invert(a-v))).style("display","block")):(B.style("display","none"),C.style("display","none"),D.style("display","none"))}),m.on("mouseleave",function(){B.style("display","none"),C.style("display","none"),D.style("display","none")}),{sidePadding:v}};document.addEventListener("DOMContentLoaded",function(){"undefined"==typeof window.Roadmap&&e(),window.Roadmap={init:e}})}();